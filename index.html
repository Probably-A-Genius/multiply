<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mental Math Trainer</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-color: black;
            color: limegreen;
            font-family: monospace;
            text-align: center;
        }
        #problem {
            font-size: 4em;
            margin: 20px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            line-height: 1.5em;
        }
        .multiplication-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .multiplication-container span {
            font-size: 1.5em;
        }
        #answer {
            background: black;
            border: 2px solid limegreen;
            color: limegreen;
            font-size: 3em;
            text-align: center;
            outline: none;
            width: 200px;
            margin: 20px auto;
            display: block;
        }
        #results, #stats {
            display: none;
            text-align: left;
            margin: 20px auto;
            width: 60%;
            border: 1px solid limegreen;
            padding: 15px;
            font-size: 1.5em;
        }
        .missed {
            color: red;
        }
    </style>
</head>
<body>
    <h1 style="font-size: 3em;">Mental Math Trainer</h1>
    <div id="settings">
        <label style="font-size: 1.5em;">Number of Questions: <input type="number" id="numQuestions" value="10"></label>
        <label style="font-size: 1.5em;">Time per Question (seconds): <input type="number" id="timeLimit" value="2"></label>
        <button style="font-size: 1.5em;" onclick="startQuiz()">Start</button>
        <button style="font-size: 1.5em;" onclick="showStats()">Stats</button>
    </div>
    <div id="quiz" style="display:none;">
        <div id="problem" class="multiplication-container"></div>
        <input type="text" id="answer" autocomplete="off" autofocus>
        <div id="timer" style="font-size: 2em; margin-top: 10px;"></div>
    </div>
    <div id="results"></div>
    <div id="stats">
        <h2>Progress Stats</h2>
        <canvas id="progressChart"></canvas>
    </div>
    <script>
        let problems = [], index = 0, correctAnswers = [], times = [], timer, answerTimeout;
        let progressData = JSON.parse(localStorage.getItem("progressData")) || [];
        function startQuiz() {
            let numQuestions = document.getElementById("numQuestions").value;
            let timeLimit = document.getElementById("timeLimit").value * 1000;
            problems = [];
            correctAnswers = [];
            times = [];
            index = 0;
            for (let i = 0; i < numQuestions; i++) {
                let a = Math.floor(Math.random() * 90) + 10;
                let b = Math.floor(Math.random() * 90) + 10;
                problems.push({ a, b, answer: a * b });
            }
            document.getElementById("settings").style.display = "none";
            document.getElementById("quiz").style.display = "block";
            nextProblem(timeLimit);
        }
        function nextProblem(timeLimit) {
            if (index >= problems.length) return showResults();
            clearTimeout(timer);
            clearTimeout(answerTimeout);
            let problem = problems[index];
            document.getElementById("problem").innerHTML = `<div class="multiplication-container"><div>${problem.a}<br>x ${problem.b}</div></div>`;
            let answerInput = document.getElementById("answer");
            answerInput.value = "";
            answerInput.style.display = "block";
            answerInput.focus();
            let startTime = Date.now();
            timer = setTimeout(() => {
                document.getElementById("problem").innerHTML = `<div class="multiplication-container"><div>${problem.a}<br>x ${problem.b}<br>=<br>${problem.answer}</div></div>`;
                answerInput.style.display = "none";
                answerTimeout = setTimeout(() => {
                    times.push(timeLimit / 1000);
                    correctAnswers.push(`<span class='missed'>Missed (Ans: ${problem.answer})</span>`);
                    index++;
                    nextProblem(timeLimit);
                }, 5000);
            }, timeLimit);
            answerInput.oninput = function() {
                let userAnswer = parseInt(this.value);
                if (userAnswer === problem.answer) {
                    clearTimeout(timer);
                    clearTimeout(answerTimeout);
                    times.push((Date.now() - startTime) / 1000);
                    correctAnswers.push(`${problem.a} Ã— ${problem.b} = ${problem.answer} (Correct)`);
                    index++;
                    nextProblem(timeLimit);
                }
            };
        }
        function showResults() {
            document.getElementById("quiz").style.display = "none";
            let resultsDiv = document.getElementById("results");
            resultsDiv.innerHTML = "<h2>Results</h2>";
            let totalTime = times.reduce((a, b) => a + b, 0);
            let meanTime = (totalTime / times.length).toFixed(2);
            let bestOf10 = Math.min(...times.slice(-10));
            let bestOf50 = Math.min(...times.slice(-50));
            let bestOf100 = Math.min(...times.slice(-100));
            progressData.push(parseFloat(meanTime));
            localStorage.setItem("progressData", JSON.stringify(progressData));
            resultsDiv.innerHTML += `Set Mean: ${meanTime}s | BO10: ${bestOf10}s | BO50: ${bestOf50}s | BO100: ${bestOf100}s<br><br>`;
            resultsDiv.innerHTML += correctAnswers.map((result, i) => `Q${i + 1}: ${result} - Time: ${times[i]}s<br>`).join("");
            resultsDiv.style.display = "block";
            document.getElementById("settings").style.display = "block";
        }
    </script>
</body>
</html>
